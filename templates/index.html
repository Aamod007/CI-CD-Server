<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CI/CD Pipeline - Professional DevOps Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: #e2e8f0; min-height: 100vh; }
        
        /* Auth Page */
        .auth-container { min-height: 100vh; display: flex; }
        .auth-left { flex: 1; display: flex; flex-direction: column; justify-content: center; padding: 60px; background: #0f172a; }
        .auth-right { flex: 1; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); display: flex; align-items: center; justify-content: center; padding: 60px; }
        .auth-right-content { text-align: center; color: white; }
        .auth-right h2 { font-size: 32px; margin-bottom: 16px; }
        .auth-right p { font-size: 16px; opacity: 0.9; max-width: 400px; }
        
        .logo { display: flex; align-items: center; gap: 12px; margin-bottom: 48px; }
        .logo-icon { width: 48px; height: 48px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 12px; display: flex; align-items: center; justify-content: center; }
        .logo-icon i { font-size: 24px; color: white; }
        .logo-text { font-size: 24px; font-weight: 700; color: white; }
        
        .auth-form { max-width: 400px; }
        .auth-form h1 { font-size: 28px; color: white; margin-bottom: 8px; }
        .auth-form p { color: #94a3b8; margin-bottom: 32px; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; color: #94a3b8; font-size: 14px; margin-bottom: 8px; font-weight: 500; }
        .form-group input { width: 100%; padding: 14px 16px; background: #1e293b; border: 1px solid #334155; border-radius: 10px; color: white; font-size: 15px; transition: all 0.2s; }
        .form-group input:focus { outline: none; border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99,102,241,0.2); }
        .form-group input::placeholder { color: #64748b; }
</style>
</head>
<body>
    <!-- Auth Section -->
    <div id="auth-section" class="auth-container">
        <div class="auth-left">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-rocket"></i></div>
                <span class="logo-text">CI/CD Pipeline</span>
            </div>
            <div class="auth-form">
                <h1 id="auth-title">Welcome back</h1>
                <p id="auth-subtitle">Sign in to your account to continue</p>
                <div id="alert-auth"></div>
                
                <form id="login-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email address</label>
                        <input type="email" id="login-email" required placeholder="you@example.com">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="login-password" required placeholder="••••••••">
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Sign In</button>
                </form>
                
                <form id="register-form" class="hidden" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label>Email address</label>
                        <input type="email" id="register-email" required placeholder="you@example.com">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="register-password" required placeholder="••••••••">
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Create Account</button>
                </form>
                
                <div class="divider"><span>or continue with</span></div>
                
                <button class="btn btn-github btn-full" onclick="loginWithGithub()">
                    <i class="fab fa-github"></i> Continue with GitHub
                </button>
                
                <p class="auth-switch">
                    <span id="switch-text">Don't have an account?</span>
                    <a href="#" onclick="toggleAuthMode(event)" id="switch-link">Sign up</a>
                </p>
            </div>
        </div>
        <div class="auth-right">
            <div class="auth-right-content">
                <i class="fas fa-code-branch" style="font-size: 80px; margin-bottom: 24px; opacity: 0.9;"></i>
                <h2>Automate Your Workflow</h2>
                <p>Build, test, and deploy your code automatically. Connect your GitHub repositories and run CI/CD pipelines with ease.</p>
            </div>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboard" class="hidden">
        <nav class="navbar">
            <div class="nav-left">
                <div class="logo">
                    <div class="logo-icon"><i class="fas fa-rocket"></i></div>
                    <span class="logo-text">CI/CD Pipeline</span>
                </div>
            </div>
            <div class="nav-right">
                <a href="#" onclick="openDashboard()" class="nav-link"><i class="fas fa-chart-bar"></i> Analytics</a>
                <div class="user-menu">
                    <span id="user-email"></span>
                    <button class="btn btn-secondary btn-sm" onclick="logout()">Sign Out</button>
                </div>
            </div>
        </nav>
        
        <div class="main-content">
            <!-- GitHub Connection Card -->
            <div id="github-connect-card" class="card github-card">
                <div class="github-card-content">
                    <i class="fab fa-github github-icon"></i>
                    <h3>Connect to GitHub</h3>
                    <p>Link your GitHub account to access your repositories and run automated pipelines.</p>
                    <button class="btn btn-github" onclick="connectGithub()">
                        <i class="fab fa-github"></i> Connect GitHub Account
                    </button>
                </div>
            </div>
            
            <!-- Repo Selection (shown after GitHub connect) -->
            <div id="repo-section" class="hidden">
                <div class="section-header">
                    <h2><i class="fas fa-folder-open"></i> Your Repositories</h2>
                    <button class="btn btn-secondary btn-sm" onclick="refreshRepos()"><i class="fas fa-sync"></i> Refresh</button>
                </div>
                <div id="repos-grid" class="repos-grid"></div>
            </div>
            
            <!-- Pipeline Config Modal -->
            <div id="pipeline-modal" class="modal hidden">
                <div class="modal-content modal-lg">
                    <div class="modal-header">
                        <h3><i class="fas fa-cog"></i> Configure Pipeline</h3>
                        <button class="btn-close" onclick="closePipelineModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="config-section">
                            <label>Repository</label>
                            <div id="selected-repo" class="selected-repo"></div>
                        </div>
                        <div class="config-section">
                            <label>Branch</label>
                            <select id="branch-select" class="form-select"></select>
                        </div>
                        <div class="config-section">
                            <label>Entry File (optional)</label>
                            <div id="file-browser" class="file-browser"></div>
                        </div>
                        <div class="config-section">
                            <label>Build Commands</label>
                            <textarea id="build-commands" class="form-textarea" placeholder="pip install -r requirements.txt&#10;python main.py"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closePipelineModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="runPipeline()"><i class="fas fa-play"></i> Run Pipeline</button>
                    </div>
                </div>
            </div>

            <!-- Jobs Section -->
            <div class="section-header">
                <h2><i class="fas fa-tasks"></i> Recent Pipelines</h2>
                <button class="btn btn-secondary btn-sm" onclick="loadJobs()"><i class="fas fa-sync"></i> Refresh</button>
            </div>
            <div id="jobs-container" class="jobs-list"></div>
        </div>
    </div>
    
    <!-- Logs Modal -->
    <div id="logs-modal" class="modal hidden">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class="fas fa-terminal"></i> Pipeline Logs</h3>
                <button class="btn-close" onclick="closeLogsModal()">&times;</button>
            </div>
            <div class="modal-body logs-body" id="logs-container"></div>
        </div>
    </div>

    <style>
        .hidden { display: none !important; }
        
        .btn { padding: 12px 24px; border: none; border-radius: 10px; cursor: pointer; font-family: inherit; font-size: 14px; font-weight: 600; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99,102,241,0.4); }
        .btn-secondary { background: #334155; color: #e2e8f0; }
        .btn-secondary:hover { background: #475569; }
        .btn-github { background: #24292e; color: white; }
        .btn-github:hover { background: #2f363d; }
        .btn-full { width: 100%; justify-content: center; }
        .btn-sm { padding: 8px 16px; font-size: 13px; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-close { background: none; border: none; color: #94a3b8; font-size: 24px; cursor: pointer; }
        
        .divider { display: flex; align-items: center; margin: 24px 0; color: #64748b; font-size: 13px; }
        .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: #334155; }
        .divider span { padding: 0 16px; }
        
        .auth-switch { text-align: center; margin-top: 24px; color: #94a3b8; font-size: 14px; }
        .auth-switch a { color: #6366f1; text-decoration: none; font-weight: 500; }
        
        .alert { padding: 12px 16px; border-radius: 8px; margin-bottom: 16px; font-size: 14px; }
        .alert-error { background: rgba(239,68,68,0.1); color: #ef4444; border: 1px solid rgba(239,68,68,0.2); }
        .alert-success { background: rgba(34,197,94,0.1); color: #22c55e; border: 1px solid rgba(34,197,94,0.2); }
        
        /* Navbar */
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 16px 32px; background: rgba(15,23,42,0.95); border-bottom: 1px solid #334155; backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; }
        .nav-left .logo { margin-bottom: 0; }
        .nav-right { display: flex; align-items: center; gap: 24px; }
        .nav-link { color: #94a3b8; text-decoration: none; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 8px; transition: color 0.2s; }
        .nav-link:hover { color: #6366f1; }
        .user-menu { display: flex; align-items: center; gap: 16px; }
        .user-menu span { color: #94a3b8; font-size: 14px; }
        
        /* Main Content */
        .main-content { max-width: 1200px; margin: 0 auto; padding: 32px; }
        
        /* Cards */
        .card { background: #1e293b; border: 1px solid #334155; border-radius: 16px; padding: 24px; margin-bottom: 24px; }
        .github-card { text-align: center; padding: 48px; }
        .github-card-content { max-width: 400px; margin: 0 auto; }
        .github-icon { font-size: 64px; color: #6366f1; margin-bottom: 24px; }
        .github-card h3 { font-size: 24px; margin-bottom: 12px; color: white; }
        .github-card p { color: #94a3b8; margin-bottom: 24px; line-height: 1.6; }
        
        /* Section Header */
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .section-header h2 { font-size: 18px; color: white; display: flex; align-items: center; gap: 10px; }
        .section-header h2 i { color: #6366f1; }
        
        /* Repos Grid */
        .repos-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; margin-bottom: 32px; }
        .repo-card { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s; }
        .repo-card:hover { border-color: #6366f1; transform: translateY(-2px); }
        .repo-card h4 { color: white; font-size: 16px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .repo-card h4 i { color: #6366f1; }
        .repo-card p { color: #94a3b8; font-size: 13px; margin-bottom: 12px; }
        .repo-meta { display: flex; gap: 16px; font-size: 12px; color: #64748b; }
        .repo-meta span { display: flex; align-items: center; gap: 4px; }
        
        /* Jobs List */
        .jobs-list { background: #1e293b; border: 1px solid #334155; border-radius: 16px; overflow: hidden; }
        .job-item { display: flex; align-items: center; padding: 20px 24px; border-bottom: 1px solid #334155; transition: background 0.2s; }
        .job-item:last-child { border-bottom: none; }
        .job-item:hover { background: rgba(99,102,241,0.05); }
        .status-indicator { width: 12px; height: 12px; border-radius: 50%; margin-right: 16px; }
        .status-pending { background: #64748b; }
        .status-running { background: #3b82f6; animation: pulse 1.5s infinite; }
        .status-success { background: #22c55e; }
        .status-failed { background: #ef4444; }
        .status-cancelled { background: #f59e0b; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .job-info { flex: 1; }
        .job-name { color: white; font-weight: 600; font-size: 15px; margin-bottom: 4px; }
        .job-meta { color: #64748b; font-size: 13px; }
        .job-status { padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase; margin-right: 16px; }
        .job-status.pending { background: rgba(100,116,139,0.2); color: #94a3b8; }
        .job-status.running { background: rgba(59,130,246,0.2); color: #60a5fa; }
        .job-status.success { background: rgba(34,197,94,0.2); color: #4ade80; }
        .job-status.failed { background: rgba(239,68,68,0.2); color: #f87171; }
        .job-status.cancelled { background: rgba(245,158,11,0.2); color: #fbbf24; }
        .job-actions { display: flex; gap: 8px; }
        
        /* Modal */
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: #1e293b; border: 1px solid #334155; border-radius: 16px; width: 90%; max-width: 600px; max-height: 80vh; display: flex; flex-direction: column; }
        .modal-lg { max-width: 800px; }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid #334155; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { color: white; font-size: 18px; display: flex; align-items: center; gap: 10px; }
        .modal-header h3 i { color: #6366f1; }
        .modal-body { padding: 24px; overflow-y: auto; flex: 1; }
        .modal-footer { padding: 16px 24px; border-top: 1px solid #334155; display: flex; justify-content: flex-end; gap: 12px; }
        
        /* Form Elements */
        .form-select, .form-textarea { width: 100%; padding: 12px 16px; background: #0f172a; border: 1px solid #334155; border-radius: 8px; color: white; font-family: inherit; font-size: 14px; }
        .form-select:focus, .form-textarea:focus { outline: none; border-color: #6366f1; }
        .form-textarea { min-height: 120px; resize: vertical; }
        .config-section { margin-bottom: 20px; }
        .config-section label { display: block; color: #94a3b8; font-size: 14px; margin-bottom: 8px; font-weight: 500; }
        .selected-repo { background: #0f172a; padding: 12px 16px; border-radius: 8px; color: white; display: flex; align-items: center; gap: 10px; }
        
        /* File Browser */
        .file-browser { background: #0f172a; border: 1px solid #334155; border-radius: 8px; max-height: 200px; overflow-y: auto; }
        .file-item { padding: 10px 16px; display: flex; align-items: center; gap: 10px; cursor: pointer; border-bottom: 1px solid #1e293b; color: #94a3b8; font-size: 13px; }
        .file-item:hover { background: rgba(99,102,241,0.1); color: white; }
        .file-item.selected { background: rgba(99,102,241,0.2); color: #6366f1; }
        .file-item i { width: 16px; }
        .file-item.folder i { color: #fbbf24; }
        .file-item.file i { color: #6366f1; }
        
        /* Logs */
        .logs-body { background: #0f172a; font-family: 'SF Mono', 'Fira Code', monospace; font-size: 13px; padding: 16px; max-height: 400px; overflow-y: auto; }
        .log-line { padding: 4px 0; color: #94a3b8; }
        .log-line.info { color: #94a3b8; }
        .log-line.warn { color: #fbbf24; }
        .log-line.error { color: #f87171; }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 48px; color: #64748b; }
        .empty-state i { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
        .empty-state p { font-size: 15px; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .auth-container { flex-direction: column; }
            .auth-right { display: none; }
            .auth-left { padding: 32px; }
            .navbar { padding: 12px 16px; flex-wrap: wrap; gap: 12px; }
            .main-content { padding: 16px; }
            .repos-grid { grid-template-columns: 1fr; }
        }
    </style>

    <script>
        const API = '/api';
        let token = localStorage.getItem('token');
        let githubToken = localStorage.getItem('github_token');
        let selectedRepo = null;
        let logsInterval = null;
        let isLoginMode = true;

        if (token) checkAuth();

        async function api(endpoint, options = {}) {
            const headers = { 'Content-Type': 'application/json' };
            if (token) headers['Authorization'] = `Bearer ${token}`;
            const res = await fetch(`${API}${endpoint}`, { ...options, headers });
            return res.json();
        }

        function showAlert(containerId, message, type) {
            document.getElementById(containerId).innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => document.getElementById(containerId).innerHTML = '', 4000);
        }

        function toggleAuthMode(e) {
            e.preventDefault();
            isLoginMode = !isLoginMode;
            document.getElementById('login-form').classList.toggle('hidden', !isLoginMode);
            document.getElementById('register-form').classList.toggle('hidden', isLoginMode);
            document.getElementById('auth-title').textContent = isLoginMode ? 'Welcome back' : 'Create account';
            document.getElementById('auth-subtitle').textContent = isLoginMode ? 'Sign in to your account to continue' : 'Get started with your free account';
            document.getElementById('switch-text').textContent = isLoginMode ? "Don't have an account?" : 'Already have an account?';
            document.getElementById('switch-link').textContent = isLoginMode ? 'Sign up' : 'Sign in';
        }

        async function handleLogin(e) {
            e.preventDefault();
            const data = await api('/auth/login', {
                method: 'POST',
                body: JSON.stringify({ email: document.getElementById('login-email').value, password: document.getElementById('login-password').value })
            });
            if (data.token) { token = data.token; localStorage.setItem('token', token); checkAuth(); }
            else showAlert('alert-auth', data.error || 'Login failed', 'error');
        }

        async function handleRegister(e) {
            e.preventDefault();
            const data = await api('/auth/register', {
                method: 'POST',
                body: JSON.stringify({ email: document.getElementById('register-email').value, password: document.getElementById('register-password').value })
            });
            if (data.token) { token = data.token; localStorage.setItem('token', token); checkAuth(); }
            else showAlert('alert-auth', data.error || 'Registration failed', 'error');
        }

        async function checkAuth() {
            const data = await api('/auth/me');
            if (data.email) {
                document.getElementById('user-email').textContent = data.email;
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                checkGithubConnection();
                loadJobs();
            } else logout();
        }

        function logout() {
            token = null; 
            githubToken = null;
            localStorage.removeItem('token');
            localStorage.removeItem('github_token');
            document.getElementById('auth-section').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        function loginWithGithub() {
            const clientId = 'YOUR_GITHUB_CLIENT_ID'; // Replace with your GitHub OAuth App Client ID
            const redirectUri = encodeURIComponent(window.location.origin + '/api/auth/github/callback');
            const scope = 'repo,user:email';
            window.location.href = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}`;
        }

        function connectGithub() {
            loginWithGithub();
        }

        function checkGithubConnection() {
            // For demo, show repos section. In production, check if GitHub is connected
            if (githubToken) {
                document.getElementById('github-connect-card').classList.add('hidden');
                document.getElementById('repo-section').classList.remove('hidden');
                loadRepos();
            }
        }

        async function loadRepos() {
            // Demo repos - in production, fetch from GitHub API
            const repos = [
                { name: 'my-project', description: 'A sample project', language: 'Python', stars: 12, updated: '2 days ago' },
                { name: 'web-app', description: 'React web application', language: 'JavaScript', stars: 45, updated: '1 week ago' },
                { name: 'api-server', description: 'REST API backend', language: 'Python', stars: 8, updated: '3 days ago' },
            ];
            
            const grid = document.getElementById('repos-grid');
            grid.innerHTML = repos.map(repo => `
                <div class="repo-card" onclick="selectRepo('${repo.name}')">
                    <h4><i class="fas fa-book"></i> ${repo.name}</h4>
                    <p>${repo.description || 'No description'}</p>
                    <div class="repo-meta">
                        <span><i class="fas fa-circle" style="color: ${getLanguageColor(repo.language)}; font-size: 8px;"></i> ${repo.language}</span>
                        <span><i class="fas fa-star"></i> ${repo.stars}</span>
                        <span><i class="fas fa-clock"></i> ${repo.updated}</span>
                    </div>
                </div>
            `).join('');
        }

        function getLanguageColor(lang) {
            const colors = { Python: '#3572A5', JavaScript: '#f1e05a', TypeScript: '#2b7489', Java: '#b07219', Go: '#00ADD8', Rust: '#dea584' };
            return colors[lang] || '#6366f1';
        }

        function selectRepo(repoName) {
            selectedRepo = repoName;
            document.getElementById('selected-repo').innerHTML = `<i class="fas fa-book" style="color: #6366f1;"></i> ${repoName}`;
            document.getElementById('branch-select').innerHTML = '<option value="main">main</option><option value="master">master</option><option value="develop">develop</option>';
            loadFileBrowser();
            document.getElementById('pipeline-modal').classList.remove('hidden');
        }

        function loadFileBrowser() {
            // Demo file structure - in production, fetch from GitHub API
            const files = [
                { type: 'folder', name: 'src' },
                { type: 'folder', name: 'tests' },
                { type: 'file', name: 'main.py' },
                { type: 'file', name: 'requirements.txt' },
                { type: 'file', name: 'README.md' },
                { type: 'file', name: 'setup.py' },
            ];
            
            const browser = document.getElementById('file-browser');
            browser.innerHTML = files.map(f => `
                <div class="file-item ${f.type}" onclick="selectFile(this, '${f.name}')">
                    <i class="fas fa-${f.type === 'folder' ? 'folder' : 'file-code'}"></i>
                    ${f.name}
                </div>
            `).join('');
        }

        function selectFile(el, filename) {
            document.querySelectorAll('.file-item').forEach(f => f.classList.remove('selected'));
            el.classList.add('selected');
            
            // Auto-suggest commands based on file
            const commands = document.getElementById('build-commands');
            if (filename.endsWith('.py')) {
                commands.value = `pip install -r requirements.txt\npython ${filename}`;
            } else if (filename === 'package.json') {
                commands.value = 'npm install\nnpm test';
            }
        }

        function closePipelineModal() {
            document.getElementById('pipeline-modal').classList.add('hidden');
            selectedRepo = null;
        }

        async function runPipeline() {
            if (!selectedRepo) return;
            
            const branch = document.getElementById('branch-select').value;
            const commands = document.getElementById('build-commands').value.split('\n').filter(c => c.trim());
            
            // For demo, use manual repo URL input
            const repoUrl = prompt('Enter full GitHub repo URL:', `https://github.com/username/${selectedRepo}`);
            if (!repoUrl) return;
            
            const data = await api('/jobs', {
                method: 'POST',
                body: JSON.stringify({ repo_url: repoUrl, branch, commands })
            });
            
            if (data.id) {
                closePipelineModal();
                loadJobs();
                showAlert('alert-auth', 'Pipeline started!', 'success');
            }
        }

        async function loadJobs() {
            const jobs = await api('/jobs');
            const container = document.getElementById('jobs-container');
            
            if (!jobs || !jobs.length) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>No pipelines yet. Connect GitHub and run your first pipeline!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = jobs.map(job => `
                <div class="job-item">
                    <div class="status-indicator status-${job.status}"></div>
                    <div class="job-info">
                        <div class="job-name">${job.repo_url ? job.repo_url.split('/').pop() : 'Unknown'}</div>
                        <div class="job-meta">${job.branch || 'main'} • ${new Date(job.created_at).toLocaleString()}</div>
                    </div>
                    <span class="job-status ${job.status}">${job.status}</span>
                    <div class="job-actions">
                        <button class="btn btn-secondary btn-sm" onclick="viewLogs('${job.id}')"><i class="fas fa-terminal"></i> Logs</button>
                        ${job.status === 'running' ? `<button class="btn btn-danger btn-sm" onclick="cancelJob('${job.id}')"><i class="fas fa-stop"></i></button>` : ''}
                        ${['failed','cancelled'].includes(job.status) ? `<button class="btn btn-primary btn-sm" onclick="retryJob('${job.id}')"><i class="fas fa-redo"></i></button>` : ''}
                        <button class="btn btn-secondary btn-sm" onclick="deleteJob('${job.id}')"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
        }

        async function viewLogs(jobId) {
            document.getElementById('logs-modal').classList.remove('hidden');
            loadLogs(jobId);
            logsInterval = setInterval(() => loadLogs(jobId), 3000);
        }

        async function loadLogs(jobId) {
            const logs = await api(`/jobs/${jobId}/logs`);
            const container = document.getElementById('logs-container');
            if (!logs || !logs.length) {
                container.innerHTML = '<div class="log-line">Waiting for logs...</div>';
                return;
            }
            container.innerHTML = logs.map(log => `<div class="log-line ${log.level}">[${log.level.toUpperCase()}] ${log.message}</div>`).join('');
            container.scrollTop = container.scrollHeight;
        }

        function closeLogsModal() {
            document.getElementById('logs-modal').classList.add('hidden');
            if (logsInterval) clearInterval(logsInterval);
        }

        async function cancelJob(id) { await api(`/jobs/${id}/cancel`, { method: 'POST' }); loadJobs(); }
        async function retryJob(id) { await api(`/jobs/${id}/retry`, { method: 'POST' }); loadJobs(); }
        async function deleteJob(id) { if (confirm('Delete this pipeline?')) { await api(`/jobs/${id}`, { method: 'DELETE' }); loadJobs(); } }
        
        function refreshRepos() { loadRepos(); }
        
        function openDashboard() {
            if (token) {
                window.open(`/dashboard/?token=${encodeURIComponent(token)}`, '_blank');
            }
        }
    </script>
</body>
</html>
